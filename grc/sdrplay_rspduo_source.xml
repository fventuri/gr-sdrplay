<?xml version="1.0"?>
<block>
    <name>RSPduo Source</name>
    <key>sdrplay_rspduo_source</key>
    <category>SDRplay</category>
    <flags>throttle</flags>
    <import>import sdrplay</import>
    <make>sdrplay.rspduo_source(
        '$rspduo_mode',
        #if $rspduo_mode() == 'ST'
        $sample_rate_single_tuner,
        #else
        $sample_rate_non_single_tuner,
        #end if
        $rf_freq,
        '$antenna',
        $device_serial,
        $agc_enabled,
        $if_atten_db,
        $lna_atten_step,
        $bcast_notch,
        $dab_notch,
        '$output_type',
        $dc_offset_mode,
        $iq_balance_mode,
        $biasT,
        $debug_enabled
    )
    </make>

    <callback>set_rf_freq($rf_freq)</callback>
    <callback>set_agc_enabled($agc_enabled)</callback>
    <callback>set_if_atten_db($if_atten_db)</callback>
    <callback>set_biasT($biasT)</callback>
    <callback>set_lna_atten_step($lna_atten_step)</callback>

    <!-- General -->
    <param>
        <name>RSPduo mode</name>
        <key>rspduo_mode</key>
        <type>enum</type>
        <hide>none</hide>
        <option>
            <name>Single Tuner</name>
            <key>ST</key>
            <opt>num_outputs:1</opt>
        </option>
        <option>
            <name>Dual Tuner</name>
            <key>DT</key>
            <opt>num_outputs:2</opt>
        </option>
        <option>
            <name>Master</name>
            <key>MA6</key>
            <opt>num_outputs:1</opt>
        </option>
        <option>
            <name>Master (RSPduo sample rate=8MHz)</name>
            <key>MA8</key>
            <opt>num_outputs:1</opt>
        </option>
        <option>
            <name>Slave</name>
            <key>SL</key>
            <opt>num_outputs:1</opt>
        </option>
    </param>

    <param>
        <name>Sample Rate ST (Hz)</name>
        <key>sample_rate_single_tuner</key>
        <value></value>
        <type>enum</type>
        <hide>#if $rspduo_mode() == 'ST' then 'none' else 'all'#</hide>
        <option>
            <name>62500</name>
            <key>62500</key>
        </option>
        <option>
            <name>125000</name>
            <key>125000</key>
        </option>
        <option>
            <name>250000</name>
            <key>250000</key>
        </option>
        <option>
            <name>500000</name>
            <key>500000</key>
        </option>
        <option>
            <name>1000000</name>
            <key>1000000</key>
        </option>
        <option>
            <name>2000000</name>
            <key>2000000</key>
        </option>
        <option>
            <name>2048000</name>
            <key>2048000</key>
        </option>
        <option>
            <name>3000000</name>
            <key>3000000</key>
        </option>
        <option>
            <name>4000000</name>
            <key>4000000</key>
        </option>
        <option>
            <name>5000000</name>
            <key>5000000</key>
        </option>
        <option>
            <name>6000000</name>
            <key>6000000</key>
        </option>
        <option>
            <name>7000000</name>
            <key>7000000</key>
        </option>
        <option>
            <name>8000000</name>
            <key>8000000</key>
        </option>
        <option>
            <name>9000000</name>
            <key>9000000</key>
        </option>
        <option>
            <name>10000000</name>
            <key>10000000</key>
        </option>
    </param>

    <param>
        <name>Sample Rate NST (Hz)</name>
        <key>sample_rate_non_single_tuner</key>
        <value></value>
        <type>enum</type>
        <hide>#if $rspduo_mode() != 'ST' then 'none' else 'all'#</hide>
        <option>
            <name>62500</name>
            <key>62500</key>
        </option>
        <option>
            <name>125000</name>
            <key>125000</key>
        </option>
        <option>
            <name>250000</name>
            <key>250000</key>
        </option>
        <option>
            <name>500000</name>
            <key>500000</key>
        </option>
        <option>
            <name>1000000</name>
            <key>1000000</key>
        </option>
        <option>
            <name>2000000</name>
            <key>2000000</key>
        </option>
    </param>

    <param>
        <name>RF frequency</name>
        <key>rf_freq</key>
        <value>100e6</value>
        <type>real</type>
    </param>

    <param>
        <name>Antenna</name>
        <key>antenna</key>
        <value>T1_50ohm</value>
        <type>enum</type>
        <option>
            <name>Tuner1 50ohm</name>
            <key>T1_50ohm</key>
        </option>
        <option>
            <name>Tuner 2_50ohm</name>
            <key>T2_50ohm</key>
        </option>
        <option>
            <name>High Z</name>
            <key>HIGHZ</key>
        </option>
    </param>

    <param>
        <name>DeviceIndex or Serial#</name>
        <key>device_serial</key>
        <type>string</type>
    </param>

    <!-- Gain Options -->
    <param>
        <name>AGC</name>
        <key>agc_enabled</key>
        <value>True</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Gain Options</tab>
    </param>

    <param>
        <name>IF Attenuation (dB)</name>
        <key>if_atten_db</key>
        <value>40</value>
        <type>real</type>
        <hide>part</hide>
        <tab>Gain Options</tab>
    </param>

    <param>
        <name>LNA Attenuation Step</name>
        <key>lna_atten_step</key>
        <value>0</value>
        <type>real</type>
        <hide>part</hide>
        <tab>Gain Options</tab>
    </param>

    <!-- Filter Options -->
    <param>
        <name>Broadcast Notch Filter</name>
        <key>bcast_notch</key>
        <value>False</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Filter Options</tab>
    </param>

    <param>
        <name>DAB Notch Filter</name>
        <key>dab_notch</key>
        <value>False</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Filter Options</tab>
    </param>

    <!-- Other options -->
    <param>
        <name>Output Type</name>
        <key>output_type</key>
        <type>enum</type>
        <hide>part</hide>
        <option>
            <name>Complex float32</name>
            <key>fc32</key>
        </option>
        <option>
            <name>Complex int16 (native)</name>
            <key>sc16</key>
        </option>
        <tab>Other Options</tab>
    </param>

    <param>
        <name>DC Offset Mode</name>
        <key>dc_offset_mode</key>
        <value>True</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Other Options</tab>
    </param>

    <param>
        <name>IQ Balance Mode</name>
        <key>iq_balance_mode</key>
        <value>True</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Other Options</tab>
    </param>

    <param>
        <name>BiasT</name>
        <key>biasT</key>
        <value>False</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Other Options</tab>
    </param>

    <param>
        <name>Debug</name>
        <key>debug_enabled</key>
        <value>False</value>
        <type>bool</type>
        <hide>part</hide>
        <tab>Other Options</tab>
    </param>


    <source>
        <name>out</name>
        <type>$output_type</type>
        <nports>$rspduo_mode.num_outputs</nports>
    </source>

    <doc>
The SDRplay RSPduo Source Block:

Device Selector:
The device selector is a delimited string used to locate SDRplay devices on your system. \
If left blank, the first SDRplay RSPduo found will be used. \
Use the device serial number to specify a specific device.
Example: 1234567890

RSPduo Mode:
This parameter selects the operating mode of the RSPduo device.
Valid selections are:
Single Tuner
Dual Tuner
Master (default sampling rate)
Master (RSPduo sample rate=8MHz)
Slave

Output Type:
This parameter controls the data type of the stream in gnuradio.

    </doc>
</block>
